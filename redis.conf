# ==============================================================================
# 专为 Docker 环境优化的 Redis 配置文件
# ==============================================================================

# 1. 网络配置
# ------------------------------------------------------------------------------
# 绑定到所有网络接口，允许来自容器外部的连接。
# 在 Docker 中，默认的网络模式下，这是允许外部访问的标准配置。
bind 0.0.0.0

# Redis 监听的端口。
port 6379

# 保护模式。当启用时，只有本地连接和密码认证的连接被允许。
# 在 Docker 中，通常建议开启，并配合密码使用。
protected-mode yes

# 2. 通用配置
# ------------------------------------------------------------------------------
# 关闭守护进程模式。Docker 容器的主进程应该是 Redis 服务器本身，
# 而不是在后台运行。
daemonize no

# 当 Redis 不是以守护进程运行时，是否将 PID 写入文件。
# 在 Docker 中通常不需要。
pidfile /var/run/redis.pid

# 3. 日志配置
# ------------------------------------------------------------------------------
# 日志级别。
loglevel notice

# 将日志输出到标准输出。这是 Docker 的标准做法，
# 允许通过 `docker logs <container_id>` 查看日志。
logfile ""

# 4. 持久化配置 (RDB)
# ------------------------------------------------------------------------------
# 配置 RDB 持久化的触发条件。
# 你可以根据数据重要性调整这些值。
save 900 1
save 300 10
save 60 10000

# 如果持久化出错，是否停止接受写操作。
stop-writes-on-bgsave-error yes

# RDB 文件压缩。
rdbcompression yes

# RDB 文件校验和。
rdbchecksum yes

# RDB 文件名。
dbfilename dump.rdb

# 数据文件（RDB 和 AOF）存放的目录。
# 在 Dockerfile 中，通常会将此目录声明为 VOLUME。
dir /data

# 5. 持久化配置 (AOF)
# ------------------------------------------------------------------------------
# 默认关闭 AOF。如需更高的数据安全性，可开启。
appendonly no

# AOF 文件名。
appendfilename "appendonly.aof"

# AOF 同步策略。
appendfsync everysec

# 6. 内存管理
# ------------------------------------------------------------------------------
# 设置 Redis 最大使用内存。
# 在 Docker 中，建议通过 `--memory` 限制容器内存，并在此处设置一个略小于容器内存的值。
# 例如，如果容器限制为 1GB，可以设置为 900mb。
# maxmemory 900mb

# 当内存达到 maxmemory 时的淘汰策略。
maxmemory-policy allkeys-lru

# 7. 安全配置
# ------------------------------------------------------------------------------
# 设置连接密码。
# !!! 警告：在生产环境中，强烈建议不要在这里硬编码密码。
# 更好的方式是在启动容器时通过环境变量注入，例如：
# docker run -e REDIS_PASSWORD=mysecretpassword redis
# 然后在你的 Docker 镜像启动脚本中动态修改这个配置。
# requirepass my_default_password

# 8. 其他配置
# ------------------------------------------------------------------------------
# 数据库数量。
databases 16

# 设置客户端连接的超时时间（秒）。0 表示永不超时。
timeout 0

# TCP keepalive。
tcp-keepalive 300